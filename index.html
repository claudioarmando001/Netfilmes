<!DOCTYPE html>
<html lang="pt-MZ">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notícias CLD | Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --p: #1a73e8; --bg: #fff; --txt: #202124; --brd: #dadce0; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Google Sans', sans-serif; background: var(--bg); color: var(--txt); }

        .header { position: sticky; top: 0; background: #fff; z-index: 1000; padding: 12px 16px; border-bottom: 1px solid var(--brd); display: flex; align-items: center; gap: 15px; }
        .logo { font-size: 20px; font-weight: 700; text-decoration: none; color: var(--txt); flex: 1; }
        .logo span { color: var(--p); }

        /* Categorias com Scroll */
        .cats { display: flex; gap: 8px; overflow-x: auto; padding: 12px; border-bottom: 1px solid var(--brd); scrollbar-width: none; }
        .cat { padding: 8px 16px; border: 1px solid var(--brd); border-radius: 20px; font-size: 14px; white-space: nowrap; cursor: pointer; transition: 0.2s; }
        .cat.active { background: #e8f0fe; color: var(--p); border-color: var(--p); }

        /* Feed */
        .feed { max-width: 600px; margin: 0 auto; padding: 16px; }
        
        /* Card Estilo Profissional */
        .n-card { display: block; text-decoration: none; color: inherit; border: 1px solid var(--brd); border-radius: 16px; margin-bottom: 20px; overflow: hidden; animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .n-img { width: 100%; height: 200px; object-fit: cover; background: #f1f3f4; }
        .n-body { padding: 16px; }
        .n-body h2 { font-size: 19px; line-height: 1.3; margin-bottom: 8px; }
        .n-footer { display: flex; align-items: center; gap: 8px; font-size: 12px; color: #5f6368; }
        .src-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--p); }

        /* Loader de Scroll Infinito */
        #inf-loader { text-align: center; padding: 20px; display: none; }
    </style>
</head>
<body>

<header class="header">
    <a href="#" class="logo">Notícias <span>CLD</span></a>
    <i class="fas fa-search"></i>
</header>

<div class="cats">
    <div class="cat active">Todas</div>
    <div class="cat">Política</div>
    <div class="cat">Economia</div>
    <div class="cat">Desporto</div>
    <div class="cat">Mundo</div>
    <div class="cat">Tecnologia</div>
</div>

<main class="feed" id="mainFeed"></main>
<div id="inf-loader"><i class="fas fa-circle-notch fa-spin"></i> Carregando mais...</div>

<script>
    const SOURCES = [
        { name: "O País", slug: "opais", api: "https://opais.co.mz/wp-json/wp/v2/posts?_embed&per_page=5" },
        { name: "Carta MZ", slug: "carta", api: "https://cartamz.com/wp-json/wp/v2/posts?_embed&per_page=5" }
    ];

    let page = 1;
    let loading = false;

    // Função para carregar e injetar notícias UMA A UMA
    async function fetchIndividual(source) {
        try {
            const r = await fetch(`${source.api}&page=${page}`);
            const posts = await r.json();
            
            for (const p of posts) {
                renderPost({
                    id: p.id,
                    title: p.title.rendered,
                    src: source.name,
                    slug: source.slug,
                    img: p._embedded?.['wp:featuredmedia']?.[0]?.source_url || 'https://via.placeholder.com/400x200?text=Sem+Imagem',
                    date: new Date(p.date).toLocaleDateString()
                });
            }
        } catch(e) {}
    }

    function renderPost(p) {
        const feed = document.getElementById('mainFeed');
        const card = document.createElement('a');
        card.className = 'n-card';
        card.href = `artigo.html?id=${p.id}&src=${p.slug}`;
        card.innerHTML = `
            <img class="n-img" src="${p.img}" loading="lazy">
            <div class="n-body">
                <div class="n-footer"><div class="src-dot"></div> ${p.src} • ${p.date}</div>
                <h2 style="margin-top:8px">${p.title}</h2>
            </div>
        `;
        feed.appendChild(card);
    }

    async function loadAll() {
        if(loading) return;
        loading = true;
        document.getElementById('inf-loader').style.display = 'block';
        
        // Executa as buscas em paralelo, mas os posts aparecem conforme chegam
        await Promise.all(SOURCES.map(s => fetchIndividual(s)));
        
        loading = false;
        document.getElementById('inf-loader').style.display = 'none';
        page++;
    }

    // Lógica de Scroll Infinito
    window.onscroll = () => {
        if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 500) {
            loadAll();
        }
    };

    window.onload = loadAll;
</script>
</body>
</html>
