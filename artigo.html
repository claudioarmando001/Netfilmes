<!DOCTYPE html>
<html lang="pt-MZ">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Radar News PRO | Lendo...</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700;800&family=Lora:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #0f172a; --accent: #e11d48; --bg: #ffffff; --card: #f8fafc;
            --text: #0f172a; --text-meta: #64748b; --border: #e2e8f0;
        }
        body.dark-mode {
            --bg: #020617; --card: #1e293b; --text: #f8fafc; --text-meta: #94a3b8; --border: #334155;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; transition: 0.3s; }
        
        .toolbar { position: sticky; top: 0; background: var(--bg); padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); z-index: 100; }
        .back-btn { cursor: pointer; text-decoration: none; color: inherit; font-weight: 700; display: flex; align-items: center; gap: 8px; }
        
        .container { max-width: 750px; margin: 0 auto; padding: 20px; }
        .source-badge { font-weight: 800; text-transform: uppercase; font-size: 0.75rem; color: var(--accent); letter-spacing: 1px; display: block; margin-bottom: 10px; }
        
        h1 { font-size: 1.8rem; line-height: 1.3; margin-bottom: 20px; font-weight: 800; }
        .featured-img { width: 100%; border-radius: 20px; margin-bottom: 25px; object-fit: cover; max-height: 400px; }
        
        .article-content { font-family: 'Lora', serif; font-size: 1.2rem; color: var(--text); line-height: 1.8; }
        .article-content p { margin-bottom: 20px; }
        .article-content img { max-width: 100%; height: auto; border-radius: 12px; margin: 15px 0; }
        
        .share-fab { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; background: var(--accent); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; box-shadow: 0 10px 25px rgba(225, 29, 72, 0.4); cursor: pointer; border: none; }

        #loading { text-align: center; padding: 100px 20px; font-weight: 600; color: var(--text-meta); }
    </style>
</head>
<body>

<nav class="toolbar">
    <a href="index.html" class="back-btn"><i class="fas fa-arrow-left"></i> Voltar</a>
    <div style="display:flex; gap:20px; align-items: center;">
        <i class="fas fa-headphones" onclick="speakText()" style="cursor:pointer"></i>
        <i class="fas fa-moon" onclick="toggleTheme()" style="cursor:pointer"></i>
    </div>
</nav>

<div id="loading"><i class="fas fa-circle-notch fa-spin"></i> A preparar leitura...</div>

<main id="main-content" style="display:none">
    <article class="container">
        <span class="source-badge" id="source-name">FONTE</span>
        <h1 id="title"></h1>
        <img id="main-img" src="" class="featured-img">
        <div id="content" class="article-content"></div>
    </article>
</main>

<button class="share-fab" onclick="shareNow()"><i class="fas fa-share-alt"></i></button>

<script>
// Mapeamento das APIs
const API_MAP = {
    'opais': { name: 'O PAÍS', endpoint: 'https://opais.co.mz/wp-json/wp/v2/posts/', color: '#e11d48' },
    'carta': { name: 'CARTA MZ', endpoint: 'https://cartamz.com/wp-json/wp/v2/posts/', color: '#000' },
    'mznews': { name: 'MZNEWS', endpoint: 'https://mznews.co.mz/wp-json/wp/v2/posts/', color: '#2563eb' }
};

async function loadArticle() {
    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get('id');
    const srcKey = urlParams.get('src');

    if (!id || !srcKey || !API_MAP[srcKey]) {
        window.location.href = 'index.html';
        return;
    }

    const source = API_MAP[srcKey];

    try {
        const response = await fetch(`${source.endpoint}${id}?_embed`);
        const data = await response.json();

        // Preencher dados
        document.title = data.title.rendered;
        document.getElementById('source-name').innerText = source.name;
        document.getElementById('source-name').style.color = source.color;
        document.getElementById('title').innerHTML = data.title.rendered;
        document.getElementById('main-img').src = data._embedded?.['wp:featuredmedia']?.[0]?.source_url || '';
        document.getElementById('content').innerHTML = data.content.rendered;

        // Mostrar conteúdo
        document.getElementById('loading').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';

    } catch (error) {
        document.getElementById('loading').innerHTML = "Notícia não encontrada ou erro de conexão.";
    }
}

function shareNow() {
    if (navigator.share) {
        navigator.share({
            title: document.getElementById('title').innerText,
            url: window.location.href
        });
    } else {
        navigator.clipboard.writeText(window.location.href);
        alert("Link copiado para partilhar!");
    }
}

function speakText() {
    const text = document.getElementById('content').innerText;
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'pt-PT';
    speechSynthesis.speak(utterance);
}

function toggleTheme() {
    document.body.classList.toggle('dark-mode');
    localStorage.setItem('dark-mode', document.body.classList.contains('dark-mode'));
}

window.onload = () => {
    if(localStorage.getItem('dark-mode') === 'true') document.body.classList.add('dark-mode');
    loadArticle();
};
</script>
</body>
</html>
